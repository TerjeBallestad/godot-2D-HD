---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - project.godot
  - scenes/interior/interior_scene.tscn
  - scenes/interior/interior_scene.gd
autonomous: true

must_haves:
  truths:
    - "WorldEnvironment applies ACES tone mapping to the scene"
    - "Layered lighting creates warm interior ambiance with cool window accent"
    - "Camera shows scene from isometric-style angle"
    - "SSAO adds subtle depth in corners and crevices"
  artifacts:
    - path: "project.godot"
      provides: "Texture filtering set to Nearest for pixel art"
      contains: "textures/canvas_textures/default_texture_filter"
    - path: "scenes/interior/interior_scene.tscn"
      provides: "Main scene with WorldEnvironment, lighting, camera"
      min_lines: 50
    - path: "scenes/interior/interior_scene.gd"
      provides: "Optional scene controller for future phases"
      min_lines: 5
  key_links:
    - from: "scenes/interior/interior_scene.tscn"
      to: "WorldEnvironment"
      via: "Environment resource embedded in scene"
      pattern: "type=\"Environment\""
    - from: "scenes/interior/interior_scene.tscn"
      to: "Camera3D"
      via: "Camera configured with perspective and isometric angle"
      pattern: "Camera3D"
---

<objective>
Create the core scene infrastructure for the HD-2D interior scene with WorldEnvironment, layered lighting, and isometric camera.

Purpose: Establishes the rendering foundation (ACES tone mapping, SSAO, ambient light, glow) and lighting setup (window daylight + warm lamps + fireplace) that all subsequent phases build upon. This is the "viewing environment" that makes the HD-2D evaluation possible.

Output: A runnable Godot scene with professional rendering pipeline configured and visible lighting effects.
</objective>

<execution_context>
@/Users/godstemning/.claude/get-shit-done/workflows/execute-plan.md
@/Users/godstemning/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Configure project settings for pixel art rendering</name>
  <files>project.godot</files>
  <action>
Update project.godot to add the following settings for pixel art:

1. Set default texture filter to Nearest (critical for pixel art):
   - Under [rendering] section, add: textures/canvas_textures/default_texture_filter=0

2. Ensure Forward Plus renderer is configured (already present, verify)

Note: Godot 4.6 uses integer values for texture filter (0=Nearest, 1=Linear). This prevents pixel art from appearing blurry when displayed on Sprite3D.
  </action>
  <verify>
Read project.godot and confirm:
- textures/canvas_textures/default_texture_filter=0 is present
- rendering_device/driver settings unchanged
  </verify>
  <done>Project configured for crisp pixel art rendering with Nearest-neighbor filtering as default.</done>
</task>

<task type="auto">
  <name>Task 2: Create interior scene with WorldEnvironment and layered lighting</name>
  <files>scenes/interior/interior_scene.tscn, scenes/interior/interior_scene.gd</files>
  <action>
Create the main interior scene following the research-defined structure:

**Scene hierarchy (interior_scene.tscn):**
```
InteriorScene (Node3D) [attach interior_scene.gd]
├── WorldEnvironment
│   └── [Environment resource with ACES, SSAO, glow]
├── Lighting (Node3D)
│   ├── WindowLight (DirectionalLight3D)
│   ├── Lamps (Node3D)
│   │   ├── TableLamp (OmniLight3D)
│   │   └── FloorLamp (OmniLight3D)
│   └── Fireplace (OmniLight3D)
├── Environment (Node3D) [empty - for room geometry later]
├── Assets (Node3D) [empty - for Sprite3D furniture in Plan 02]
└── Camera3D
```

**WorldEnvironment settings (LOCKED from CONTEXT.md/RESEARCH.md):**
- Background: BG_COLOR, Color(0.05, 0.05, 0.08) - dark blue-gray interior
- Ambient: SOURCE_COLOR, Color(0.4, 0.35, 0.3), energy 0.3 - warm fill
- Tone mapping: ACES, exposure 1.0, white 6.0 - Octopath dreamy look
- SSAO: enabled, intensity 1.5, radius 1.0, power 1.5 - subtle depth
- Glow: enabled, intensity 0.5, bloom 0.1, SOFTLIGHT blend, HDR threshold 1.2

**Lighting settings (LOCKED from CONTEXT.md):**
- WindowLight: Color(0.85, 0.9, 1.0) cool daylight, energy 0.4, rotation (-35, -60, 0), shadows enabled
- TableLamp: Color(1.0, 0.85, 0.65) ~2700K warm, energy 2.0, range 10.0, attenuation 1.2, position (2, 2, 0)
- FloorLamp: Color(1.0, 0.85, 0.65) ~2700K warm, energy 1.5, range 8.0, attenuation 1.2, position (-2, 2, 2)
- Fireplace: Color(1.0, 0.65, 0.35) ~1800K fire, energy 2.5, range 6.0, attenuation 1.5, position (-3, 1, 0)

**Camera3D settings:**
- Projection: PERSPECTIVE (NOT orthographic - needed for depth effects)
- FOV: 50 degrees
- Rotation: (-35, -45, 0) - isometric-style "looking into" angle
- Position: (8, 6, 8) - overview of room
- Near: 0.1, Far: 100.0

**interior_scene.gd:**
Minimal script that extends Node3D. Add a class_name for easy referencing. Can be extended later for scene transitions.

Create the directories if they don't exist: scenes/interior/
  </action>
  <verify>
1. Open scene in Godot editor: godot --editor scenes/interior/interior_scene.tscn
2. Verify scene tree matches hierarchy
3. Check WorldEnvironment settings in inspector
4. Verify lighting colors and positions
5. Camera preview should show isometric angle with warm-lit empty room
  </verify>
  <done>
Interior scene exists with:
- WorldEnvironment applying ACES tone mapping (visible in HDR color treatment)
- Layered lighting visible (warm dominant, cool window accent)
- SSAO darkening corners (visible when geometry added)
- Glow softening bright areas
- Camera at isometric angle showing the scene
  </done>
</task>

</tasks>

<verification>
After completing both tasks:

1. Run the scene: `godot --path /Users/godstemning/Projects/godot-2D-HD scenes/interior/interior_scene.tscn`
2. Observe:
   - Scene renders without errors
   - Background is dark blue-gray (not sky)
   - Light sources visible in empty room (warm dominant glow)
   - Camera positioned at isometric angle

If verification fails, check:
- Environment resource is attached to WorldEnvironment node
- Light nodes are children of correct parents
- Camera is set as current camera in scene
</verification>

<success_criteria>
- [ ] project.godot has texture filter set to Nearest (0)
- [ ] scenes/interior/interior_scene.tscn exists and loads without errors
- [ ] WorldEnvironment has ACES tone mapping configured
- [ ] 4 light sources exist (1 directional + 3 omni)
- [ ] Camera3D positioned at (-35, -45, 0) rotation with 50 FOV
- [ ] Scene runs and displays warm interior lighting atmosphere
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
